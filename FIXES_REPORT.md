# 六爻纳甲计算项目改进报告

## 改进内容

本次改进主要集中在六爻卦象信息的显示方面，使其更加专业和符合传统六爻排盘格式。具体改进内容如下：

### 1. 卦宫显示优化

- 修复了卦宫名称中的重复问题，如将"震宫宫"改为"震宫"
- 在 `gua_display.py` 中添加了 `remove_duplicate_gong` 函数专门处理这一问题

### 2. 爻位图形格式美化

- 优化了六爻图像格式，参考 najia 库的显示效果
- 改进了阳爻和阴爻的符号表示，使用更加直观的图形
  - 阳爻：`▅▅▅▅▅▅▅▅` 或 `■■■■■■■■`
  - 阴爻：`▅▅▅  ▅▅▅` 或 `■■■  ■■■`

### 3. 六亲、六神和纳甲信息显示

- 在爻位图形中正确显示六亲、六神和纳甲信息
- 优化了信息的排版和对齐方式
- 在 najia 库风格的显示中，使用了更加清晰的格式排列这些信息

### 4. 动爻标识改进

- 改进了动爻标识，使用 `×→` 代替原来的 `X`
- 确保动爻标识与爻符号之间的间距适当

### 5. 排盘格式整体优化

- 整体优化了排盘格式，使其更加符合传统六爻排盘方式
- 添加了两种不同的排盘显示格式：
  1. 原有的增强版格式
  2. 符合 najia 库风格的新格式

### 6. 纳甲计算改进

- 在 `AccurateNajia.py` 中改进了天干地支的计算方法
- 更新了地支对应五行的映射关系
- 优化了变卦纳甲的计算逻辑

## 修改的文件

本次改进主要修改了以下文件：

1. `/models/liuyao/modules/gua_display.py`
   - 添加了 `remove_duplicate_gong` 函数
   - 修改了 `generate_full_gua_display` 函数，优化排盘格式
   - 新增 `generate_najia_style_display` 函数，提供 najia 库风格的显示

2. `/models/liuyao/modules/gua_palace.py`
   - 修改了 `identify_gua_palace_type` 方法，处理卦宫重复问题
   - 更新了 `get_palace_diagram` 方法，修复卦宫名称问题

3. `/models/liuyao/modules/AccurateNajia.py`
   - 改进了 `_calculate_najia` 方法，优化天干地支的计算
   - 更新了 `_calculate_bian_najia` 方法，改进变卦纳甲的计算逻辑

4. `/liuyao_najia.py`
   - 更新了排盘显示部分，调用新的格式化显示函数
   - 添加了参考样式的排盘格式显示

## 改进效果

改进后的排盘格式更加清晰、美观，符合传统六爻排盘习惯，具体表现为：

1. 卦宫和卦名信息更加规范
2. 爻位图形显示更加直观
3. 六亲、六神、纳甲信息布局合理
4. 动爻、世爻、应爻标识更加清晰
5. 整体排版更加专业

## 后续可能的改进方向

1. 进一步优化纳甲计算的准确性
2. 添加更多排盘格式选项
3. 支持更多的排盘信息显示，如六爻互卦、八宫详细信息等
4. 进一步完善变卦的显示
5. 优化结果导出功能，支持更多格式输出

